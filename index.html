<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Home Revival Brisbane</title>
  <link rel="icon" type="image/png" href="favicon.png" />
  <link rel="stylesheet" href="index_style.css"/>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <!-- AOS Animations -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
  <script src="https://js.stripe.com/v3/"></script>
</head>
<body>

  <!-- Prefer to Call Banner -->
  <div class="call-banner">
    Prefer to call? ğŸ“ Reach us at <a href="tel:0408540150">0408 540 150</a>
  </div>

  <!-- Header -->
  <header>
    <div class="logo"><a href="index.html">Home Revival Brisbane</a></div>
    <nav>
      <ul> 
        <li><a href="contact.html">Contact</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="terms.html">Terms</a></li>
        <li><a href="privacy.html">Privacy Policy</a></li>
      </ul>
    </nav>
  </header>

  <!-- Hero Section -->
  <section id="hero">
    <div class="hero-content" data-aos="fade-up">
      <h1>Home help, minus the hassle.</h1>
      <p>From leaking taps to urgent yard cleanups â€” we connect Brisbane locals with trusted professionals fast.</p>
    </div>
  </section>

  <!-- Story Section -->
  <section id="story" class="story-section">
    <h2 data-aos="fade-up">Why Choose Home Revival Brisbane?</h2>
    <p data-aos="fade-up" data-aos-delay="100">
      Weâ€™re not just another app or marketplace. Weâ€™re real locals who know the area and know whoâ€™s worth calling.
    </p>
    <div class="story-grid">
      <div class="story-card" data-aos="fade-up" data-aos-delay="200">
        <h3>ğŸ‘¨â€ğŸ”§ Real People</h3>
        <p>We only connect you with hand-picked professionals weâ€™d trust in our own homes.</p>
      </div>
      <div class="story-card" data-aos="fade-up" data-aos-delay="300">
        <h3>âš¡ Fast Response</h3>
        <p>Most requests are matched within hours. When time matters, weâ€™ve got your back.</p>
      </div>
      <div class="story-card" data-aos="fade-up" data-aos-delay="400">
        <h3>ğŸ”¨ All Jobs Welcome</h3>
        <p>Big or small, urgent or flexible â€” if it needs doing, weâ€™ll find the right person.</p>
      </div>
    </div>
    <div style="margin-top: 2em; text-align: center;">
      <a href="about.html" class="cta-btn story-btn" data-aos="zoom-in" data-aos-delay="500">Learn More</a>
    </div>
  </section>

  <!-- Services Section -->
  <section id="services">
    <h2 data-aos="fade-up">Ready to Get Started?</h2>
    <p data-aos="fade-up" data-aos-delay="100">Select a service to request help effortlessly.</p>
    <div class="service-container" data-aos="fade-up" data-aos-delay="200">
      <div class="service" data-service="Plumbing">ğŸš¿<br />Plumbing</div>
      <div class="service" data-service="Electrical">ğŸ’¡<br />Electrical</div>
      <div class="service" data-service="Painting">ğŸ¨<br />Painting</div>
      <div class="service" data-service="Gardening">ğŸŒ¿<br />Gardening</div>
      <div class="service" data-service="Cleaning">ğŸ§¹<br />Cleaning</div>
      <div class="service" data-service="Appliances">ğŸ› ï¸<br />Appliances</div>
      <div class="service" data-service="Carpentry">ğŸ”¨<br />Carpentry</div>
      <div class="service" data-service="Plastering">ğŸ§±<br />Plastering</div>
      <div class="service" data-service="Furniture">ğŸª‘<br />Furniture</div>
      <div class="service" data-service="Other">â“<br />Other</div>
    </div>
  </section>

  <!-- First Modal: Service Form -->
  <div class="modal hidden" id="contactForm">
    <div class="modal-content scrollable">
      <span class="close-btn" onclick="closeForm()">&times;</span>
      <h2 id="formTitle">Request Help</h2>
      <p id="feeNote"></p>
      <form id="serviceRequestForm">
        <label class="required">Your Name:</label>
        <input type="text" name="name" required />
        <label class="required">Email:</label>
        <input type="email" name="email" required />
        <label class="required">Phone:</label>
        <input type="tel" name="phone" required />
        <label class="required">Address:</label>
        <input type="text" name="address" required />
        <label>Preferred completion date:</label>
        <input type="date" name="completionDate" />
        <label class="checkbox-label">
  <input type="checkbox" name="urgent" /> Urgent (+$40)
</label>
        <label>Budget:</label>
        <input type="text" name="budget" />
        <label class="required">Job Description:</label>
        <textarea name="additionalInfo" required></textarea>
        <label class="checkbox-label required">
  <input type="checkbox" name="terms" required />
  I agree to <a href="terms.html">Terms and Conditions.</a>
</label>
        <div id="formErrorMsg" class="error-msg"></div>
        <button type="submit">Submit Request</button>
      </form>
    </div>
  </div>

  <!-- Second Modal: Order Summary -->
  <div class="modal hidden" id="orderSummaryModal">
    <div class="modal-content scrollable">
      <span class="close-btn" onclick="cancelOrderSummary()">&times;</span>
      <h2>Confirm Your Request</h2>
      <div id="orderDetails"></div>
      <button id="confirmPaymentBtn">Confirm & Proceed</button>
    </div>
  </div>

  <!-- Third Modal: Stripe Payment -->
  <div class="modal hidden" id="paymentModal">
    <div class="modal-content scrollable">
      <span class="close-btn" onclick="cancelPayment()">&times;</span>
      <h2>Secure Payment</h2>
      <div id="payment-element"></div>
      <button id="submitPaymentBtn">Pay Now</button>
      <div id="paymentMessage"></div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="footer-container">
      <div class="footer-left">
        <p>&copy; 2025 Home Revival Brisbane</p>
        <small>ABN: 76 698 587 269</small>
        <small>Hours: 9amâ€“5pm, Monday to Friday (excl. public holidays)</small>
      </div>
      <div class="footer-right">
        <a href="terms.html">Terms & Conditions</a>
        <span> | </span>
        <a href="privacy.html">Privacy Policy</a>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
  <script src="script.js"></script>
  <script>
    AOS.init({ duration: 700, once: true });
  </script>
  <script>
const stripe = Stripe("pk_test_YOUR_PUBLIC_KEY"); // Replace with your public key
let elements;
let clientSecret;

// Service selection
document.querySelectorAll(".service").forEach(serviceEl => {
  serviceEl.addEventListener("click", () => {
    document.querySelector("#serviceRequestForm [name='service']")?.remove();
    const input = document.createElement("input");
    input.type = "hidden";
    input.name = "service";
    input.value = serviceEl.dataset.service;
    document.getElementById("serviceRequestForm").appendChild(input);
    document.getElementById("contactForm").classList.remove("hidden");
    document.getElementById("formTitle").textContent = `Request Help: ${serviceEl.dataset.service}`;
  });
});

// Close / cancel modals
function closeForm() { document.getElementById("contactForm").classList.add("hidden"); }
function cancelOrderSummary() { document.getElementById("orderSummaryModal").classList.add("hidden"); }
function cancelPayment() { document.getElementById("paymentModal").classList.add("hidden"); }

// Handle form submission -> show order summary
document.getElementById("serviceRequestForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const service = formData.get("service") || "Other";
  const urgent = formData.get("urgent") ? true : false;
  const serviceCost = 0; // actual price will come from backend
  const urgencyFee = urgent ? 40 : 0;

  document.getElementById("orderDetails").innerHTML = `
    <p><strong>Service:</strong> ${service}</p>
    <p><strong>Urgency Fee:</strong> $${urgencyFee}</p>
    <p><strong>Total:</strong> Calculated at payment</p>
  `;

  document.getElementById("orderSummaryModal").classList.remove("hidden");
});

// Confirm & proceed -> create Stripe PaymentIntent and show payment modal
document.getElementById("confirmPaymentBtn").addEventListener("click", async () => {
  const formData = new FormData(document.getElementById("serviceRequestForm"));
  const service = formData.get("service") || "Other";
  const urgent = formData.get("urgent") ? true : false;

  // Request payment intent from backend
  const res = await fetch("http://localhost:3000/create-payment-intent", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ service, urgent })
  });
  const data = await res.json();
  clientSecret = data.clientSecret;

  document.getElementById("orderSummaryModal").classList.add("hidden");
  document.getElementById("paymentModal").classList.remove("hidden");

  // Mount Stripe Elements if not already mounted
  if (!elements) {
    elements = stripe.elements();
    const paymentElement = elements.create("payment");
    paymentElement.mount("#payment-element");
  }
});

// Handle Stripe payment
document.getElementById("submitPaymentBtn").addEventListener("click", async () => {
  const { error, paymentIntent } = await stripe.confirmPayment({
    elements,
    confirmParams: { return_url: window.location.href },
    redirect: 'if_required'
  });

  if (error) {
    document.getElementById("paymentMessage").textContent = error.message;
    return;
  }

  document.getElementById("paymentMessage").textContent = "Payment successful! âœ…";

  // Log order to backend
  const formData = new FormData(document.getElementById("serviceRequestForm"));
  const orderData = Object.fromEntries(formData.entries());
  orderData.paymentId = paymentIntent.id;
  orderData.amount = paymentIntent.amount / 100;

  await fetch("http://localhost:3000/log-order", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(orderData)
  });

  document.getElementById("paymentModal").classList.add("hidden");
});
</script>


</body>
</html>
